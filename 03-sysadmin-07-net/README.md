# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. На лекции мы обсудили, что манипулировать размером окна необходимо для эффективного наполнения приемного буфера участников TCP сессии (Flow Control). Подобная проблема в полной мере возникает в сетях с высоким RTT. Например, если вы захотите передать 500 Гб бэкап из региона Юга-Восточной Азии на Восточное побережье США. [Здесь](https://www.cloudping.co/grid) вы можете увидеть и 200 и 400 мс вполне реального RTT. Подсчитайте, какого размера нужно окно TCP чтобы наполнить 1 Гбит/с канал при 300 мс RTT (берем простую ситуацию без потери пакетов). Можно воспользоваться готовым [калькулятором](https://www.switch.ch/network/tools/tcp_throughput/). Ознакомиться с [формулами](https://en.wikipedia.org/wiki/TCP_tuning), по которым работает калькулятор можно, например, на Wiki.
   > Решение. Чтобы наполнить 1 Гбит/с канал при 300 мс RTT (берем простую ситуацию без потери пакетов) нужен TCP Buffer в размере 36621.1 KByte (по калькулятору). Такой огромный размер буфера возможен? Он не ограничивается 64KByte? 

1. Во сколько раз упадет пропускная способность канала, если будет 1% потерь пакетов при передаче?
   > Решение. Упадет в 1000 раз!?

1. Какая максимальная реальная скорость передачи данных достижима при линке 100 Мбит/с? Вопрос про TCP payload, то есть цифры, которые вы реально увидите в операционной системе в тестах или в браузере при скачивании файлов. Повлияет ли размер фрейма на это?
   > Решение. 9.5 - 10 МБайт/с. Это с учетом резерва 20% bandwidth для ОС. Если резерв 20% отключить, то реальная максимальная скорость с учетом tcp mss 1460 Байт и mtu 1500 будет около 12.17 МБайт/с. При увеличении mtu (> 1500 байт) реальная скорость передачи данных будет выше.   

1. Что на самом деле происходит, когда вы открываете сайт? :)
На прошлой лекции был приведен сокращенный вариант ответа на этот вопрос. Теперь вы знаете намного больше, в частности про IP адресацию, DNS и т.д.
Опишите максимально подробно насколько вы это можете сделать, что происходит, когда вы делаете запрос `curl -I http://netology.ru` с вашей рабочей станции. Предположим, что arp кеш очищен, в локальном DNS нет закешированных записей.
   > Решение.
   > 1. Сначала идет обращение к настроенному в системе dns-серверу для определения IP-адреса узла netology.ru
   > 1. Узнав IP, приложение curl генерирует GET http запрос на этот IP. Т.к. используется параметр `-I`,то отображаться в ответе от сервера будут только HEAD (HTTP заголовки, содержимое страницы будет игнорироваться) 
   > 1. ОС на транспортном уровне L4 создает TCP сегменты для этого запроса, указывая в их заголовках source PORT (0 - 65535) и destination PORT (TCP 80)
   > 1. ОС на сетевом уровне L3 добавляет IP заголовки к TCP сегментам: source IP (свой физический ip в системе, настроенный на сетевой карте) и destination IP (это ip разрезолвленный для netology.ru, который мы узнали на 1-ом шаге)
   > 1. ОС, видя, что DST IP не принадлежит локальной сети, заданной на сетевой карте, формирует broadcast ARP запрос для всех узлов локальной сети с просьбой ответить какой MAC адрес у IP шлюза по умолчанию, заданного на сетевой карте.
   > 1. Шлюз по умолчанию (роутер), получив ARP запрос, отвечает юникастом нашему хосту, сообщая свой MAC
   > 1. Теперь наша ОС, зная MAC адрес шлюза по умолчанию, помещает его в свою локальную ARP таблицу (кэш ARP) и на уровне L2 добавляет Ethernet заголовки и хвостовики к IP пакетам из п. iv, при этом в качестве source указывается свой MAC на сетевой карте, а destination указывается как MAC шлюза по умолчанию.
   > 1. L2 фрейм уходит на роутер (шлюз по умолчанию)
   > 1. Роутер в свою очередь маршрутизирует L3-пакет, отбросив L2 заголовки и хвостовики, по своей таблице маршрутизации на нужный интерфейс.
   > 1. Как только ответный пакет придет от сервера netology.ru (от IP из п. i) на роутер, роутер его смаршрутизирует в сторону нашего хоста, т.к. в DST этого ответного пакета будет IP нашего хоста, с которого изначально сгенерировался запрос, добавляя L2 Ethernet заголовки source MAC свой MAC и DST MAC нашего хоста 
   > 1. Наша ОС поднимет этот L2 фрейм, откидывая заголовки до уровня L7
   > 1. Приложение curl отобразит в своем выводе содержимое полученного TCP ответа от сервера netology.ru
   

5. Сколько и каких итеративных запросов будет сделано при резолве домена `www.google.co.uk`?
   > Решение. Итого 4 итеративных DNS запроса:
   > 1. Запрос к одному из 13-ти корневых DNS за резолвом TLD для зоны `uk.`. Получаем авторитативный ответ - список DNS серверов `uk.` 
   > 1. Запрос к одному из полученных в предыдущем пункте DNS за резолвом для зоны `co.uk.`. Получаем авторитативный ответ - список DNS серверов `co.uk.`. Кстати этот список идентичен предыдущему, т.к. так исторически сложилось в Великобритании с этим доменом.
   > 1. Запрос к одному из полученных в предыдущем пункте DNS за резолвом для зоны `google.co.uk.`. Получаем авторитативный ответ - список DNS серверов `google.co.uk.`. Это 4 DNS сервера google: ns1.google.com, ns2.google.com, ns3.google.com, ns4.google.com.
   > 1. Итоговый A-запрос к одному из полученных в предыдущем пункте DNS за резолвом для домена `www.google.co.uk.`. Получаем результат - 108.177.14.94.  

5. Сколько доступно для назначения хостам адресов в подсети `/25`? А в подсети с маской `255.248.0.0`. Постарайтесь потренироваться в ручных вычислениях чтобы немного набить руку, не пользоваться калькулятором сразу.
   > Решение. Для маски /25 это 128-2=126 адресов для хостов. Для маски 255.248.0.0 это 524286 адресов хостов.

5. В какой подсети больше адресов, в `/23` или `/24`?
   > Очевидно, что больше в /23

5. Получится ли разделить диапазон `10.0.0.0/8` на 128 подсетей по 131070 адресов в каждой? Какая маска будет у таких подсетей?
   > Решение. Да. Это маска /15